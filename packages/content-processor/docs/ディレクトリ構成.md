# ğŸ—‚ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¤‰æ›ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€Œcontent-processorã€

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

> **ç›®çš„** : Mono-repo å†…ã§ã®é…ç½®ãƒ»ãƒ“ãƒ«ãƒ‰æ‰‹é †ãƒ»ä¾å­˜ã®å¢ƒç•Œã‚’æ˜ç¢ºã«ã—ã€é–‹ç™ºè€…ãŒè¿·ã‚ãšã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã§ãã‚‹çŠ¶æ…‹ã‚’ä½œã‚‹ã€‚

---

## 1. ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«

```text
pnpm-workspace.yaml      # ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å®šç¾©
package.json             # ãƒ«ãƒ¼ãƒˆ dev ãƒ„ãƒ¼ãƒ«ã ã‘ (eslint, prettier, vitest)
configs/                 # å…±é€šè¨­å®š (tsconfig.base.json, eslint, tsup)
```

### ãƒ«ãƒ¼ãƒˆ `package.json` ä¾‹ (æŠœç²‹)

```jsonc
{
  "private": true,
  "workspaces": ["apps/*", "packages/*"],
  "scripts": {
    "build": "pnpm -r build",
    "test": "pnpm -r test"
  },
  "devDependencies": {
    "eslint": "^8.0.0",
    "tsup": "^7.2.0",
    "vitest": "^1.0.0"
  }
}
```

---

## 2. apps/ ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼

```text
apps/
â””â”€ svelte-blog/          # ãƒ–ãƒ­ã‚°æœ¬ä½“ (SvelteKit)
   â”œâ”€ src/
   â”œâ”€ static/
   â”œâ”€ svelte.config.js
   â””â”€ package.json        # app å›ºæœ‰ä¾å­˜ (content-processor ã¯ã“ã“ã§ install)
```

- **ä¾å­˜ãƒãƒªã‚·ãƒ¼** : ã‚¢ãƒ—ãƒªå´ã¯ `content-processor` ã¨å¿…è¦ãª embed ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã ã‘ã‚’ `dependencies` ã«æŒã¤ã€‚

---

## 3. packages/ ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼

```text
packages/
â”‚
â”œâ”€ content-processor/         # â˜…ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚   â”œâ”€ src/
â”‚   â”‚   â”œâ”€ index.ts           # public API
â”‚   â”‚   â”œâ”€ pipeline.ts        # unified() ãƒ“ãƒ«ãƒ€ãƒ¼
â”‚   â”‚   â”œâ”€ types.ts           # PostMeta å‹ãªã©
â”‚   â”‚   â””â”€ plugins/
â”‚   â”‚       â”œâ”€ link-transform.ts
â”‚   â”‚       â””â”€ image-transform.ts
â”‚   â”œâ”€ test/                  # Vitest cases
â”‚   â”œâ”€ tsconfig.json
â”‚   â””â”€ package.json
â”‚
â”œâ”€ remark-embed-youtube/
â”‚   â””â”€ src/index.ts
â”œâ”€ remark-embed-twitter/
â”œâ”€ remark-embed-github/
â””â”€ remark-embed-amazon/
```

### ãƒã‚¤ãƒ³ãƒˆ

| ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª           | å½¹å‰²                                      | build              | publish                                      |
| ---------------------- | ----------------------------------------- | ------------------ | -------------------------------------------- |
| **content-processor**  | Front-matter æŠ½å‡º & HTML ç”Ÿæˆ             | `tsup` ã§ ESM å‡ºåŠ› | npm: `@estrivault/content-processor`         |
| **remark-embed-\* ç³»** | å€‹åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– â†’ `<Component />` å¤‰æ› | å„è‡ª `tsup`        | npm: `@estrivault/remark-embed-youtube` ãªã© |

> **meta ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸** ã‚’ä½œã‚‹å ´åˆã¯ `remark-embed-all` ã‚’ sibling ã«é…ç½®ã—ã€ä¾å­˜ã¨ã—ã¦ 4 ã¤ã‚’è¦æ±‚ã€‚

---

## 4. å…±é€š tsconfig & ESLint

```
configs/
â”œâ”€ tsconfig.base.json  # "paths": { "@/*": ["packages/*/src"] }
â””â”€ eslint.base.js      # import/no-extraneous-dependencies â†’ workspace ãƒ«ãƒ¼ãƒ«
```

å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® `tsconfig.json` ã¯

```jsonc
{
  "extends": "../../configs/tsconfig.base.json",
  "compilerOptions": {
    "outDir": "dist",
    "rootDir": "src"
  },
  "include": ["src"]
}
```

---

## 5. ãƒ“ãƒ«ãƒ‰ & ç™ºè¡Œãƒ•ãƒ­ãƒ¼

1. **é–‹ç™º** : `pnpm dev` (SvelteKit) â†’ `content-processor` ãŒ src å‚ç…§ã§å³åæ˜ 
2. **ãƒ†ã‚¹ãƒˆ** : `pnpm test` ãƒ«ãƒ¼ãƒˆã§å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® Vitest å®Ÿè¡Œ
3. **ãƒ“ãƒ«ãƒ‰** : `pnpm build` â†’ å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ `dist/` ä½œæˆ
4. **ãƒªãƒªãƒ¼ã‚¹** : Changesets â†’ `pnpm changeset version && pnpm -r publish`

---

## 6. ä¾å­˜é–¢ä¿‚ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

- **ã‚¢ãƒ—ãƒª â†’ ãƒ©ã‚¤ãƒ–ãƒ©ãƒª** æ–¹å‘ã®ã¿ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåŒå£«ã¯ **æ¨ªä¾å­˜ã—ãªã„**ï¼ˆå¾ªç’°å›é¿ï¼‰
- å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãŒå¿…è¦ãªå ´åˆã¯ `packages/@utils/*` ã«ã¾ã¨ã‚ã‚‹
- å¤–éƒ¨ OSS ã¯ **ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå´ã§ peerDependencies** ã«ã—ã¦ã‚¢ãƒ—ãƒªã«è§£æ±ºã•ã›ã‚‹
